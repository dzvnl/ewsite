<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>canvas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <!-- This will load your playlist.js file *from the same server* -->
    <script src="playlist.js"></script>
    
    <style>
        html, body {
            height: 100%;
            scroll-behavior: smooth;
        }
        body {
            font-family: 'VT323', monospace;
            color: #e5e5eF5;
            background-color: #000000; 
            background-image: url('IMG_4867.jpeg'); 
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
        }
        .pixel-font {
            font-family: 'VT323', monospace;
            font-smooth: never;
            -webkit-font-smoothing: none;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
        }
        
        #music-player-widget {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 50;
            width: 320px; 
            height: auto;
            background-color: rgba(0, 0, 0, 0.8);
            border: none;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }
        #music-player-widget:hover { background-color: rgba(0, 0, 0, 0.95); }
        #player-cover-art {
            width: 64px;
            height: 64px;
            flex-shrink: 0; 
            margin-right: 0.75rem; 
            border: 2px dotted #969696; 
            background-color: #111;
            image-rendering: pixelated;
        }
        #player-main { flex-grow: 1; overflow: hidden; min-width: 0; }
        #player-title {
            color: #ffffff;
            font-size: 1.125rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        #player-artist {
            font-size: 0.875rem;
            color: #969696;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }
        .player-controls-row { display: flex; align-items: center; gap: 0.25rem; }
        .player-controls-row button {
            color: #facc15;
            font-size: 1.25rem;
            flex-shrink: 0;
            padding: 0 0.25rem;
            transition: color 0.2s ease;
        }
        #play-pause-btn { font-size: 1.5rem; line-height: 1; }
        #volume-slider {
            -webkit-appearance: none;
            width: 100%; 
            flex-grow: 1;
            height: 16px; 
            background: transparent;
            margin-left: 0.5rem; 
        }
        #volume-slider::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #333;
            border: 1px solid #969696;
            cursor: pointer;
        }
        #volume-slider::-moz-range-track {
            width: 100%;
            height: 4px;
            background: #333;
            border: 1px solid #969696;
            cursor: pointer;
        }
        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #facc15; 
            border: 1px solid #000;
            border-radius: 50%;
            cursor: pointer;
            margin-top: -7px; 
        }
        #volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #facc15; 
            border: 1px solid #000;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Main Menu -->
    <nav class="fixed top-0 left-0 p-6 sm:p-8 pixel-font z-10" style="padding-top: 50px;">
        <h1 class="text-3xl lg:text-4xl text-gray-300 mb-2" style="color: #bebebe;">MAIN MENU</h1>
        <ul class="text-2xl lg:text-3xl space-y-1" style="color: #969696;">
            <li><a href="/" class="hover:text-red-900 active:text-red-900 transition-colors">HOME</a></li>
            <li><a href="/list.html" class="hover:text-red-900 active:text-red-900 transition-colors">GAMES</a></li>
            <li><a href="/updates.html" class="hover:text-red-900 active:text-red-900 transition-colors">UPDATES</a></li>
            <li><a href="/contact.html" class="hover:text-red-900 active:text-red-900 transition-colors">CONTACT</a></li>
            </ul>
    </nav>

    <!-- Splash Text -->
    <div class="fixed top-2/3 left-1/2 -translate-x-1/2 -translate-y-1/2 pixel-font text-yellow-400 text-base lg:text-lg text-center z-10 p-4">
        <p id="splash-text"></p>
    </div>

    <!-- Welcome/Auth -->
    <div class="fixed top-0 right-0 p-4 pixel-font text-yellow-400 text-sm sm:text-base text-right z-10">
        <p>2.0</p>
        <p id="welcome-message">Welcome, ?</p>
        <a href="#" id="auth-link" class="text-xs hover:text-white transition-colors" style="color: #969696;">
            (sign up / sign in)
        </a>
    </div>

    <audio id="audio-player"></audio>
    
    <div id="music-player-widget" class="pixel-font">
        <img id="player-cover-art" src="" alt="Album Cover">
        <div id="player-main">
            <div id="player-info-container" title="...">
                <div id="player-title">...</div>
                <div id="player-artist">Loading...</div>
            </div>
            <div class="player-controls-row">
                <button id="rewind-btn" title="Previous">[<<]</button>
                <button id="play-pause-btn" title="Play/Pause">[>]</button>
                <button id="skip-btn" title="Next (Shuffle)">[>>]</button>
                <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1" title="Volume">
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- CATCH ALL ERRORS AND SHOW THEM ---
            // We get the player elements first, so we can show errors
            const playerTitleEl = document.getElementById('player-title');
            const playerArtistEl = document.getElementById('player-artist');
            
            try {
                // --- Splash Text & Auth Logic ---
                const welcomeMessage = document.getElementById('welcome-message');
                const authLink = document.getElementById('auth-link');
                const splashElement = document.getElementById('splash-text');
                
                const rareSplashChance = Math.floor(Math.random() * 50); 
                if (splashElement) {
                    if (rareSplashChance === 0) {
                        splashElement.textContent = "YOUR RARE 1-in-50 LINE HERE"; 
                    } else {
                        const splashOptions = [
                            "are you a freshman?", "2 sweet teas and...", "bbq chicken alert", 
                            "trick or treat, smell my.. donuts..", "pull up to ur block with intelligence",
                            "john deere approved!", "long live futtbucker67", "six seven", "oh brother..",
                            "are you even an ew student?", "i added the proxy and ai", "get the bawlls!!",
                            "six one", "add jiggletip on clash, i only got 2100 though, am willing to put up a good game",
                            "sorry but you are not a sigma", "idk really what to say"
                        ];
                        const randomIndex = Math.floor(Math.random() * splashOptions.length);
                        splashElement.textContent = splashOptions[randomIndex];
                    }
                }
                
                function updateUI() {
                    let username = localStorage.getItem('username');
                    if (username) {
                        welcomeMessage.textContent = `Welcome, ${username}`;
                        authLink.textContent = '(sign out)';
                        authLink.onclick = signOut;
                    } else {
                        welcomeMessage.textContent = 'Welcome, ?';
                        authLink.textContent = '(sign up / sign in)';
                        authLink.onclick = signIn;
                    }
                }
                function signIn(e) {
                    e.preventDefault();
                    const name = prompt('Enter yourname:');
                    if (name && name.trim() !== '') {
                        localStorage.setItem('username', name.trim());
                        updateUI();
                    }
                }
                function signOut(e) {
                    e.preventDefault();
                    localStorage.removeItem('username');
                    updateUI();
                }
                updateUI();
                
                
                // --- MUSIC PLAYER LOGIC ---
                const audioPlayer = document.getElementById('audio-player');
                const playPauseBtn = document.getElementById('play-pause-btn');
                const rewindBtn = document.getElementById('rewind-btn');
                const skipBtn = document.getElementById('skip-btn');
                const playerInfoContainer = document.getElementById('player-info-container');
                const volumeSlider = document.getElementById('volume-slider');
                const playerCoverArt = document.getElementById('player-cover-art');
                const placeholderCover = "https://placehold.co/64x64/000000/333333?text=...&font=vt323";
                playerCoverArt.src = placeholderCover; 

                let currentSongIndex = 0;
                let isPlaying = false;
                
                // --- CHECK 1: ARE THE FILES LOADED? ---
                if (typeof playlist === 'undefined' || typeof baseURL === 'undefined') {
                    playerTitleEl.textContent = "File Load Error";
                    playerArtistEl.textContent = "playlist.js missing";
                    return; // Stop the script
                }

                const secretSong = {
                    title: "hey, big guy said im an easter egg",
                    artist: "i heard, if u put /secret at the end of the link",
                    src: baseURL + "clock.mp3",
                    cover: baseURL + "handofpeace.jpg"
                };

                function loadSong(songIndex) {
                    const song = (songIndex === -1) ? secretSong : playlist[songIndex];
                    if (!song) { return; }
                    if (!song.src || !song.cover) {
                        skipSong(true);
                        return;
                    }
                    const songSrc = song.src.replace(/ /g, "%20");
                    const coverSrc = song.cover.replace(/ /g, "%20");
                    audioPlayer.src = songSrc; 
                    playerInfoContainer.title = `${song.title} - ${song.artist}`; 
                    playerTitleEl.textContent = song.title || "...";
                    playerArtistEl.textContent = song.artist || "...";
                    playerCoverArt.src = song.cover ? coverSrc : placeholderCover;
                    playPauseBtn.textContent = '[>]';
                    isPlaying = false;
                }

                function playSong() {
                    if (!audioPlayer.src) { return; }
                    
                    audioPlayer.volume = volumeSlider.value; 
                    const playPromise = audioPlayer.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            playPauseBtn.textContent = '[||]';
                            isPlaying = true;
                        }).catch(error => {
                            // --- CHECK 2: DID PLAYBACK FAIL? ---
                            playerTitleEl.textContent = "Play Error";
                            playerArtistEl.textContent = error.name; // e.g., "NotAllowedError"
                            isPlaying = false;
                        });
                    }
                }

                function pauseSong() {
                    audioPlayer.pause();
                    playPauseBtn.textContent = '[>]';
                    isPlaying = false;
                }

                function togglePlayPause() {
                    if (isPlaying) {
                        pauseSong();
                    } else {
                        playSong();
                    }
                }

                function skipSong(skipOnly = false) {
                    let nextSongIndex = Math.floor(Math.random() * playlist.length);
                    if (nextSongIndex === currentSongIndex && playlist.length > 1) {
                        nextSongIndex = (nextSongIndex + 1) % playlist.length; 
                    }
                    currentSongIndex = nextSongIndex;
                    loadSong(currentSongIndex);
                    
                    if (audioPlayer.src && !skipOnly) {
                       playSong();
                    }
                }

                function rewindSong() {
                    if (currentSongIndex === -1) {
                        skipSong();
                    } else {
                        currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
                        loadSong(currentSongIndex);
                        if (audioPlayer.src) {
                            playSong();
                        }
                    }
                }

                window.addEventListener('beforeunload', () => {
                    if (audioPlayer.currentTime > 0) {
                        sessionStorage.setItem('musicPlayerState', JSON.stringify({
                            currentSongIndex: currentSongIndex,
                            currentTime: audioPlayer.currentTime
                        }));
                    }
                });

                function loadInitialState() {
                    const savedStateJSON = sessionStorage.getItem('musicPlayerState');
                    if (savedStateJSON) {
                        try {
                            const savedState = JSON.parse(savedStateJSON);
                            currentSongIndex = savedState.currentSongIndex; 
                            loadSong(currentSongIndex);
                            audioPlayer.addEventListener('loadedmetadata', () => {
                                audioPlayer.currentTime = savedState.currentTime || 0;
                            }, { once: true }); 
                        } catch (e) {
                            currentSongIndex = Math.floor(Math.random() * playlist.length);
                            loadSong(currentSongIndex); 
                        }
                    } else {
                        const rareSongChance = Math.floor(Math.random() * 50);
                        currentSongIndex = (rareSongChance === 0) ? -1 : Math.floor(Math.random() * playlist.length);
                        loadSong(currentSongIndex);
                    }
                    audioPlayer.volume = volumeSlider.value;
                }
                
                // --- ATTACH LISTENERS ---
                playPauseBtn.addEventListener('click', togglePlayPause);
                skipBtn.addEventListener('click', () => skipSong(false));
                rewindBtn.addEventListener('click', rewindSong);
                
                volumeSlider.addEventListener('input', (e) => {
                    audioPlayer.volume = e.target.value; // Typo fixed
                });

                audioPlayer.addEventListener('ended', () => skipSong(false));
                
                audioPlayer.addEventListener('error', (e) => {
                    // --- CHECK 3: DID THE FILE ITSELF FAIL TO LOAD (404)? ---
                    playerTitleEl.textContent = `Load Error (404?)`;
                    playerArtistEl.textContent = `Skipping...`;
                    setTimeout(() => skipSong(true), 2000); 
                });
                
                playerCoverArt.addEventListener('error', () => {
                    playerCoverArt.src = placeholderCover;
                });

                loadInitialState();
                
            } catch (e) {
                // --- CATCH ANY OTHER RANDOM ERROR (LIKE A TYPO) ---
                playerTitleEl.textContent = "Code Error";
                playerArtistEl.textContent = e.message;
            }
        });
    </script>
</body>
</html>


