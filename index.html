<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EWS LIVE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

<style>
    /* --- CORE STYLES --- */
    html, body { 
        height: 100%; 
        margin: 0;
        padding: 0;
    }
    body {
        font-family: 'VT323', monospace;
        color: #e5e5e5;
        background-color: #000000; 
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center;
        overflow-y: scroll; /* Force scrollbar for 2000s feel */
    }
    
    .pixel-font {
        font-family: 'VT323', monospace;
        -webkit-font-smoothing: none;
    }

    /* --- LAYOUT CONTAINER (The 2000s Box Look) --- */
    #main-container {
        max-width: 1024px;
        margin: 0 auto;
        min-height: 100vh;
        background: rgba(0, 0, 0, 0.95);
        box-shadow: 0 0 50px rgba(0,0,0,1);
        border-left: 2px solid #333;
        border-right: 2px solid #333;
        position: relative;
    }

    /* --- ALERT STYLES --- */
    .alert-mode {
        color: #ef4444 !important; 
        text-shadow: 0 0 10px #ef4444;
        font-weight: bold;
        animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    /* --- NAVIGATION & DROPDOWN PLAYER --- */
    .nav-item {
        position: relative;
        display: inline-block;
        cursor: pointer;
    }

    /* The Dropdown Container (Hidden by default) */
    .dropdown-content {
        display: none;
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #1a0505; /* Dark Red/Black */
        min-width: 280px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.8);
        border: 2px solid #b91c1c; /* Red Border */
        z-index: 100;
        padding: 10px;
        text-align: left;
    }

    /* Show the dropdown on hover */
    .nav-item:hover .dropdown-content {
        display: block;
    }

    /* --- PLAYER INTERNALS --- */
    #player-cover-art {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border: 1px solid #555;
        margin-bottom: 8px;
        image-rendering: pixelated;
    }
    .player-controls-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 5px;
        background: #000;
        padding: 5px;
        border: 1px solid #333;
    }
    .player-controls-row button {
        color: #facc15; /* Gold */
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
    }
    .player-controls-row button:hover { color: #fff; text-shadow: 0 0 5px #fff; }
    
    #volume-slider {
        width: 100%;
        margin-top: 10px;
        accent-color: #facc15;
    }
    
    /* --- GRID BOXES STYLING --- */
    .content-box {
        border: 2px solid #b91c1c; /* Red border like the image */
        background: radial-gradient(circle, #2a0a0a 0%, #000000 100%);
        position: relative;
        overflow: hidden;
        transition: transform 0.2s;
    }
    .content-box:hover {
        border-color: #facc15; /* Gold on hover */
    }
    .box-title {
        background: rgba(185, 28, 28, 0.8);
        color: white;
        padding: 2px 8px;
        position: absolute;
        top: 10px;
        left: 0;
        font-size: 1.2rem;
        text-transform: uppercase;
    }

</style>
</head>
<body>

<div id="main-container">
    
    <div class="flex justify-between items-center px-4 py-1 text-gray-400 text-sm border-b border-gray-800 bg-black">
        <div class="flex gap-4">
            <span class="hover:text-white cursor-pointer">JOIN THE LIST</span>
            <span class="hover:text-white cursor-pointer">BOOKMARK</span>
        </div>
        <div class="text-right">
            <span id="welcome-message">Welcome, ?</span>
            <a href="account.html" id="account-link" class="ml-2 text-red-500 hover:text-red-300">(my account)</a>
        </div>
    </div>

    <header class="relative h-24 bg-gradient-to-b from-red-900 to-black flex items-center justify-center border-b-4 border-black">
        <div class="absolute -bottom-6 bg-black rounded-full p-2 border-2 border-red-700 z-20">
             <div class="w-20 h-20 rounded-full bg-red-900 flex items-center justify-center border-2 border-yellow-600 shadow-lg shadow-red-900/50">
                <span class="text-3xl text-yellow-500 font-bold drop-shadow-md">EWS</span>
             </div>
        </div>
    </header>

    <nav class="bg-black text-xl lg:text-2xl text-gray-300 border-b border-red-800 pt-8 pb-2">
        <ul class="flex justify-center flex-wrap gap-8 lg:gap-12 uppercase tracking-widest">
            <li class="hover:text-red-500 hover:scale-110 transition-all"><a href="index.html">Home</a></li>
            <li class="hover:text-red-500 hover:scale-110 transition-all"><a href="list.html">List</a></li>
            
            <li class="nav-item text-yellow-500 font-bold border-b-2 border-transparent hover:border-yellow-500">
                RADIO ▼
                <div class="dropdown-content pixel-font text-base normal-case">
                    <img id="player-cover-art" src="https://placehold.co/64x64/000000/333333?text=...&font=vt323" alt="Album Cover">
                    <div id="player-title" class="text-white text-lg truncate">Select a Song</div>
                    <div id="player-artist" class="text-gray-400 text-sm truncate mb-2">...</div>
                    
                    <div class="player-controls-row">
                        <button id="rewind-btn" title="Previous">&lt;&lt;</button>
                        <button id="play-pause-btn" title="Play/Pause">[&gt;]</button>
                        <button id="skip-btn" title="Next">&gt;&gt;</button>
                    </div>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1" title="Volume">
                    <div class="text-center text-xs text-gray-500 mt-2">v2.0 Player</div>
                </div>
            </li>

            <li class="hover:text-red-500 hover:scale-110 transition-all"><a href="chat.html">Chat</a></li>
            <li class="hover:text-red-500 hover:scale-110 transition-all"><a href="settings.html">Settings</a></li>
        </ul>
    </nav>

    <div class="p-4 md:p-8 space-y-6">
        
        <div class="content-box w-full h-64 md:h-80 flex flex-col items-center justify-center text-center p-6 relative group">
            <div class="absolute inset-0 bg-gradient-to-r from-red-900/40 to-black/80 z-0"></div>
            <div class="z-10 relative transform group-hover:scale-105 transition-transform">
                <div class="text-yellow-500 text-2xl md:text-3xl mb-2" style="font-family: serif; font-style: italic;">EWS Live Presents</div>
                <h1 id="splash-text" class="text-4xl md:text-6xl font-bold text-white drop-shadow-[0_2px_2px_rgba(255,0,0,0.8)]">Loading...</h1>
                <div class="mt-4 text-gray-400 text-lg">Check out the new updates</div>
            </div>
             <div class="absolute bottom-4 right-4 rotate-12 border-2 border-white/20 p-2 text-white/30 text-xs">
                EST. 2025
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            
            <a href="chat.html" class="content-box h-48 block group relative">
                <div class="absolute inset-0 bg-[url('https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExcHJhZ2Z0bnZ4eGp3eXF6eXF6eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/L20mbc7yRRFja/giphy.gif')] bg-cover opacity-30 group-hover:opacity-60 transition-opacity"></div>
                <div class="box-title">B-LIVE CHAT</div>
                <div class="absolute bottom-4 left-4">
                    <h3 class="text-2xl text-white font-bold group-hover:text-yellow-400">VEGAS REWIND!</h3>
                    <p class="text-gray-400 leading-none">Join the discussion</p>
                    <div class="mt-2 bg-red-800 text-white text-xs px-2 py-1 inline-block hover:bg-red-600">ENTER NOW</div>
                </div>
            </a>

            <a href="list.html" class="content-box h-48 block group relative">
                <div class="absolute inset-0 bg-[url('https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3Z0bnZ4eGp3eXF6eXF6eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o6vXVzKWtk4JC6bcU/giphy.gif')] bg-cover opacity-30 group-hover:opacity-60 transition-opacity"></div>
                <div class="box-title">SWIM UPSTREAM</div>
                <div class="absolute bottom-4 left-4">
                    <h3 class="text-2xl text-white font-bold group-hover:text-yellow-400">THE LIST</h3>
                    <p class="text-gray-400 leading-none">Are you in?</p>
                     <div class="mt-2 bg-white text-black text-xs px-2 py-1 inline-block font-bold">VIEW LIST</div>
                </div>
            </a>

            <div class="content-box h-48 block group relative cursor-help" onclick="document.querySelector('.dropdown-content').style.display='block'">
                <div class="absolute inset-0 bg-[url('https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbnZ4eGp3eXF6eXF6eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/BlVnrxJgTGsUw/giphy.gif')] bg-cover opacity-20 group-hover:opacity-50 transition-opacity"></div>
                <div class="box-title">MP3 DOWNLOAD</div>
                <div class="absolute bottom-4 left-4">
                    <h3 class="text-2xl text-white font-bold group-hover:text-yellow-400">FREE MUSIC</h3>
                    <p class="text-gray-400 leading-none">Use the Radio Menu</p>
                    <div class="mt-2 border border-yellow-500 text-yellow-500 text-xs px-2 py-1 inline-block">LISTEN IN</div>
                </div>
            </div>

        </div>

        <div class="border-t-2 border-red-900 pt-4 pb-8 text-center text-gray-500 text-sm">
             <a href="chat.html" class="hover:text-white mx-2">version 2.0</a> | 
             <a href="#" class="hover:text-white mx-2">Contact Us</a> | 
             <a href="#" class="hover:text-white mx-2">Terms</a>
             <p class="mt-2 opacity-50">EWS Live © 2025. All Rights Reserved.</p>
        </div>
    </div>
</div>

<audio id="audio-player"></audio>
<div id="player-info-container" style="display:none;"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAlUyqTb9onQ0PyOxLfZkDddeSnYdB2PlQ",
        authDomain: "ewsitechat.firebaseapp.com",
        databaseURL: "https://ewsitechat-default-rtdb.firebaseio.com",
        projectId: "ewsitechat",
        storageBucket: "ewsitechat.firebasestorage.app",
        messagingSenderId: "282495574514",
        appId: "1:282495574514:web:e2781da630d93fc1ce8b6b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- SPLASH LOGIC ---
    const splashEl = document.getElementById('splash-text');

    // Fallback Sprashes
    const randomSplashes = [
        "blacked out like an lv sandal", "son", "bbq chicken alert", 
        "trick or treat.. smell my.. donuts..", "100 perkaholic or pounded by a margwa",
        "considering a page", "long live futtbucker", "six seven", "oh brother..",
        "are you even an ew student?", "i bet ur failing", "get the bawlls!!",
        "six one", "add jiggletip on clash", "new stuff soon",
        "WE yes WE are brainless and failing", "updates soon.. -nl", "no super seniors", "considering a chat board"
    ];

    // Listen to Admin Announcement
    const announcementRef = ref(db, 'admin/announcement');

    onValue(announcementRef, (snapshot) => {
        const data = snapshot.val();

        if (data && data.text) {
            // ADMIN MODE
            splashEl.innerText =` ${data.text.toLowerCase()} `;
            splashEl.classList.add('alert-mode');
        } else {
            // NORMAL MODE
            splashEl.classList.remove('alert-mode');
            if (splashEl.innerText.includes("ALERT") || splashEl.innerText === "Loading...") {
                splashEl.innerText = randomSplashes[Math.floor(Math.random() * randomSplashes.length)];
            }
        }
    });
</script>

<script>
    const baseURL = "https://ewsmusic1.netlify.app/"; 
    const playlist = [
        { title: "Xtal", artist: "Aphex Twin", src: baseURL + "xtal.mp3", cover: baseURL + "aphex.jpg" },
        { title: "I Don't Wanna Be Me", artist: "Type O Negative", src: baseURL + "idontwannabeme.mp3", cover: baseURL + "ton.jpg" },
        { title: "Life Is Killing Me", artist: "Type O Negative", src: baseURL + "lifeiskilling.mp3", cover: baseURL + "ton.jpg" },
        { title: "Exit Music (For a Film)", artist: "Radiohead", src: baseURL + "exitmusic.mp3", cover: baseURL + "radiohead.jpg" },
        { title: "Alternative Outro", artist: "LUCKI", src: baseURL + "alternativeoutro.mp3", cover: baseURL + "lucki.jpg" },
        { title: "Bite My Lip", artist: "fakemink", src: baseURL + "bitemylip.mp3", cover: baseURL + "fakemink.jpg" },
        { title: "Ambilux", artist: "fakemink", src: baseURL + "ambilux.mp3", cover: baseURL + "fakemink3.jpg" },
        { title: "I'm Like Why", artist: "xaviersobased", src: baseURL + "imlikewhy.mp3", cover: baseURL + "xav.jpg" },
        { title: "Love Hate", artist: "xaviersobased", src: baseURL + "lovehate.mp3", cover: baseURL + "xav2.jpg" },
        { title: "Foamposite Interlude", artist: "smokedope2016", src: baseURL + "foamposite.mp3", cover: baseURL + "smokedope2016.jpg" },
        { title: "Abysmal Depths Are Flooded", artist: "Xasthur", src: baseURL + "abysmaldepthsareflooded.mp3", cover: baseURL + "xasthur.jpg" },
        { title: "Diamonds", artist: "Chris Travis", src: baseURL + "diamonds.mp3", cover: baseURL + "christravis.jpg" },
        { title: "Black Magic", artist: "Ethel Wulf", src: baseURL + "blackmagic.mp3", cover: baseURL + "ethel.jpg" },
        { title: "4 Raws", artist: "EsDeeKid", src: baseURL + "4raws.mp3", cover: baseURL + "esdee.jpg" },
        { title: "Fever", artist: "fakemink/buckshot", src: baseURL + "fever.mp3", cover: baseURL + "buckshot.jpg" },
        { title: "Stalks", artist: "Ghost Mountain", src: baseURL + "stalks.mp3", cover: baseURL + "ghostmountain.jpg" },
        { title: "MIA", artist: "feng", src: baseURL + "mia.mp3", cover: baseURL + "feng.jpg" },
        { title: "head in the ceiling fan", artist: "Title Fight", src: baseURL + "titlefight.mp3", cover: baseURL + "title-fih.jpg" },
        { title: "Turn Me Loose", artist: "limpbizkit/eminem", src: baseURL + "turnmeloose.mp3", cover: baseURL + "limp.jpg" },
        { title: "black beetles", artist: "esdeekid", src: baseURL + "bbr.mp3", cover: baseURL + "esdee2.jpg" },
        { title: "apathy", artist: "esdeekid", src: baseURL + "apathy.mp3", cover: baseURL + "esdee3.jpg" },
        { title: "bring it back", artist: "chris travis", src: baseURL + "bib.mp3", cover: baseURL + "chris2.jpg" },
        { title: "die til you live", artist: "fakemink", src: baseURL + "dtyl.mp3", cover: baseURL + "fakemink5.jpg" },
        { title: "worthit", artist: "xaviersobased", src: baseURL + "worthit.mp3", cover: baseURL + "81853ABB-FB87-4A20-9303-9624B777245B.jpeg" },
        { title: "in da party", artist: "smokedope2016", src: baseURL + "indaparty.mp3", cover: baseURL + "smokedope4.jpg" },
        { title: "say it aint dro", artist: "smokedope2016", src: baseURL + "dro.mp3", cover: baseURL + "smokedope3.jpg" },
        { title: "blunts on my mind", artist: "ethel wulf", src: baseURL + "bluntsomm.mp3", cover: baseURL + "ethel2.jpg" },
        { title: "luper", artist: "earl sweatshirt", src: baseURL + "luper.mp3", cover: baseURL + "earl.jpg" },
        { title: "frat", artist: "smokedope2016", src: baseURL + "frat.mp3", cover: baseURL + "smokedope2.jpg" },
        { title: "hit the home", artist: "the hand of peace", src: baseURL + "clock.mp3", cover: baseURL + "handofpeace.jpg" },
        { title: "blow me", artist: "fakemink", src: baseURL + "blowme.mp3", cover: baseURL + "fakeminkk.jpg" },
        { title: "minerva", artist: "deftones", src: baseURL + "minerva.mp3", cover: baseURL + "deftones.jpg" },
        { title: "hold on", artist: "limpbizkit", src: baseURL + "holdon.mp3", cover: baseURL + "limpbizkit.jpg" },
        { title: "my way", artist: "limpbizkit", src: baseURL + "myway.mp3", cover: baseURL + "limpbizkit.jpg" },
        { title: "new update soon", artist: "-nl", src: baseURL + "xtal.mp3", cover: baseURL + "aphextwin.jpg" }
    ];

    document.addEventListener('DOMContentLoaded', () => {
        const playerTitleEl = document.getElementById('player-title');
        const playerArtistEl = document.getElementById('player-artist');
        // Hidden container logic support
        const playerInfoContainer = document.getElementById('player-info-container'); 

        try {
            // --- BACKGROUND LOGIC ---
            const specialBg = '81853ABB-FB87-4A20-9303-9624B777245B.jpeg';
            const normalBackgrounds = ['IMG_4928.jpeg', 'IMG_4946.jpeg', 'IMG_4944.jpeg', 'IMG_4943.jpeg', 'IMG_5262.jpeg', 'IMG_5263.jpeg', 'IMG_5264.jpeg', 'IMG_4945.jpeg'];
            const chance = Math.floor(Math.random() * 100); 
            let chosenBg = (chance === 0) ? specialBg : normalBackgrounds[Math.floor(Math.random() * normalBackgrounds.length)];
            document.body.style.backgroundImage = `url('${chosenBg}')`;

            // --- USER UI ---
            const welcomeMessage = document.getElementById('welcome-message');

            function updateUI() {
                let username = localStorage.getItem('username');
                if (username) {
                    welcomeMessage.textContent = `Welcome, ${username}`;
                } else {
                    welcomeMessage.textContent = 'Welcome, ?';
                }
            }
            updateUI();

            // --- MUSIC PLAYER LOGIC ---
            const audioPlayer = document.getElementById('audio-player');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const rewindBtn = document.getElementById('rewind-btn');
            const skipBtn = document.getElementById('skip-btn');
            const volumeSlider = document.getElementById('volume-slider');
            const playerCoverArt = document.getElementById('player-cover-art');
            const placeholderCover = "https://placehold.co/64x64/000000/333333?text=...&font=vt323";

            let currentSongIndex = 0;
            let isPlaying = false;

            const secretSong = {
                title: "hey, big guy said im an easter egg",
                artist: "i heard, if u put /secret at the end of the link",
                src: "clock.mp3",
                cover: "handofpeace.jpg"
            };

            function loadSong(songIndex) {
                const song = (songIndex === -1) ? secretSong : playlist[songIndex];
                if (!song || !song.src || !song.cover) {
                    skipSong(true); 
                    return;
                }

                audioPlayer.src = song.src; 
                // Updating hidden container title for compatibility if needed
                if(playerInfoContainer) playerInfoContainer.title = `${song.title} - ${song.artist}`; 
                
                playerTitleEl.textContent = song.title;
                playerArtistEl.textContent = song.artist;
                playerCoverArt.src = song.cover;
                playPauseBtn.textContent = '[>]';
                isPlaying = false;
            }

            function playSong() {
                if (!audioPlayer.src) { return; }
                audioPlayer.volume = volumeSlider.value; 

                const playPromise = audioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        playPauseBtn.textContent = '[||]';
                        isPlaying = true;
                    }).catch(error => {
                        console.warn("Auto-play blocked", error);
                    });
                }
            }

            function pauseSong() {
                audioPlayer.pause();
                playPauseBtn.textContent = '[>]';
                isPlaying = false;
            }

            function togglePlayPause() {
                if (isPlaying) { pauseSong(); } else { playSong(); }
            }

            function skipSong(skipOnly = false) {
                let nextSongIndex = Math.floor(Math.random() * playlist.length);
                if (nextSongIndex === currentSongIndex && playlist.length > 1) {
                    nextSongIndex = (nextSongIndex + 1) % playlist.length; 
                }
                currentSongIndex = nextSongIndex;
                loadSong(currentSongIndex);
                if (audioPlayer.src && !skipOnly) { playSong(); }
            }

            function rewindSong() {
                currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
                loadSong(currentSongIndex);
                if (audioPlayer.src) { playSong(); }
            }

            // --- STORAGE SAVE/LOAD ---
            window.addEventListener('beforeunload', () => {
                if (audioPlayer.currentTime > 0) {
                    const musicState = {
                        currentSongIndex: currentSongIndex,
                        currentTime: audioPlayer.currentTime,
                        volume: audioPlayer.volume,
                        isPlaying: isPlaying
                    };
                    sessionStorage.setItem('musicPlayerState', JSON.stringify(musicState));
                }
            });

            function loadInitialState() {
                const savedStateJSON = sessionStorage.getItem('musicPlayerState');
                let savedState = null;
                if (savedStateJSON) {
                    try { savedState = JSON.parse(savedStateJSON); } 
                    catch (e) { sessionStorage.removeItem('musicPlayerState'); }
                }

                if (savedState) {
                    currentSongIndex = savedState.currentSongIndex;
                    loadSong(currentSongIndex);
                    volumeSlider.value = savedState.volume || 1;
                    audioPlayer.volume = savedState.volume || 1;
                    audioPlayer.addEventListener('loadedmetadata', () => {
                        audioPlayer.currentTime = savedState.currentTime || 0;
                        if (savedState.isPlaying) { playSong(); }
                    }, { once: true }); 
                } else {
                    const rareSongChance = Math.floor(Math.random() * 50);
                    currentSongIndex = (rareSongChance === 0) ? -1 : Math.floor(Math.random() * playlist.length);
                    loadSong(currentSongIndex);
                    audioPlayer.volume = volumeSlider.value;
                }
            }

            playPauseBtn.addEventListener('click', togglePlayPause);
            skipBtn.addEventListener('click', () => skipSong(false));
            rewindBtn.addEventListener('click', rewindSong);
            volumeSlider.addEventListener('input', (e) => { audioPlayer.volume = e.target.value; });
            audioPlayer.addEventListener('ended', () => skipSong(false));
            playerCoverArt.addEventListener('error', () => { playerCoverArt.src = placeholderCover; });

            loadInitialState();

        } catch (e) {
            console.error("Script error:", e);
        }
    });
</script>
</body>
</html>
